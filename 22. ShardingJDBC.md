# 22.Sharding-JDBC

[toc]

### 分库分表的方式

- 垂直分库

    由于垂直分表，还是将表放在同一个库中，表多了必然会造成CPU，内存,IO的竞争。

    定义：通过按照业务将表进行分类，分布到不同的数据库上，每个库可以在不同的服务器上

    优点：

    1. 解决业务的耦合，业务清晰
    2. 能对不同业务的数据进行分级管理、维护、监控、扩展等
    3. 高并发场景下，垂直分库一定程度的提升IO、数据库连接数、降低单机硬件资源的瓶颈

    拆分原则：根据不同的业务进行拆分

- 水平分库

    定义：把同一个表的数据按一定规则(比如 IDHash%库数量)拆分到不同的数据库中，每个库可以放在不同的服务器上

    优点：

    1. 解决了单库大数据，高并发的性能瓶颈
    2. 减少了IO竞争，锁竞争，提高了系统稳定性，某个库出现问题，仍然有部分数据可用提高了系统的可用性

- 垂直分表

    定义：将一个表按照字段分成多个表，每个表存储其中一部分字段

    优点：

    1. <u>避免IO争抢</u>，为什么大字段效率低，第一由于数据量本身大，需要更长的读取时间；第二跨页，页是数据库存储单位，很多查找及定位操作都是以页为单位，单页内的数据行越多数据库整体性能越好，而大字段占用空间大，单页内存储行数少，因此IO效率低；第三，数据库以行为单位将数据库加载到内存中，这样表中字段长度较短且访问频率较高，内存能加载更多的数据，命中率更高，减少了磁盘IO,从而提升数据库性能
    2. <u>减少锁表的几率</u>，在通过update更新表字段的时候，会将该条记录锁定，而将字段拆分后，能减少锁表几率。如果通过冷热数据进行字段拆分，还将提供热数据的操作效率

    常见拆分原则：

    1. 把不常用的字段单独放在一张表中
    2. 把text、blob等大字段拆分放入附表中
    3. 经常组合查询的列放入同一张表

- 水平分表

    定义：在同一个库内，把同一个表的数据按一定规则拆分到多个表中

    优点：

    1. 优化单一表数据量过大而产生的性能问题
    2.  避免IO争抢并减少锁表的几率

### 笛卡尔积关联问题

